<!-- Ajoutez ceci dans la balise <head> pour inclure la police "Roboto" -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<!-- Header principal avec message de bienvenue -->
<div class="header bg-gradient-danger pb-8 pt-5 pt-md-8">
  <div class="container-fluid">
    <div class="d-flex justify-content-end mb-3" style="margin-top: -100px !important;">
      <a class="nav-link pr-0" role="button" ngbDropdownToggle>
        <div class="media align-items-center custom-frame">
          <span class="avatar avatar-sm rounded-circle">
            <img alt="Image placeholder" [src]="'assets/img/user.png'">
          </span>          <div class="media-body ml-2 d-none d-lg-block">
            <span class="mb-0 text-sm font-weight-bold text-white">{{ 'dashboard.welcome.welcomeUser' | translate:{ username: userName || 'Utilisateur' } }}</span>
          </div>
        </div>
      </a>
    </div>
    
    
    
    <div class="header-body">
      <!-- Message de bienvenue et accès rapide -->
      <div class="row align-items-center mb-4">
        <div class="col-md-8">          <h1 class="display-3 text-white" style="margin-top: -50px !important;">{{ 'dashboard.welcome.title' | translate }}</h1>
          <p class="text-white mt-2 mb-0" style="margin-top: 5px !important;">
            {{ 'dashboard.welcome.subtitle' | translate }}
          </p>
        </div>
      </div>
      <!-- Stats Cards Row -->
      <div class="row row-cols-1 row-cols-md-2 row-cols-xl-4 g-4">
        <!-- Templates Card -->
        <div class="col">
          <div class="card card-stats mb-4 mb-xl-0">
            <div class="card-body">
              <div class="row">
                <div class="col">
                  <h5 class="card-title text-uppercase text-muted mb-0">{{ 'dashboard.stats.templates' | translate }}</h5>
                  <span class="h2 font-weight-bold mb-0">{{ templatesCount }}</span>
                  <div class="mt-2">
                    <small 
                      [ngClass]="{
                        'text-success': templatesPercentageChange >= 0,
                        'text-danger': templatesPercentageChange < 0
                      }">
                      <i class="fa" 
                         [ngClass]="{
                           'fa-arrow-up': templatesPercentageChange >= 0,
                           'fa-arrow-down': templatesPercentageChange < 0
                         }"></i>
                      <span class="percentage-number">
                        {{ templatesPercentageChange | number: '1.0-0' }}%
                      </span>
                      {{ 'dashboard.stats.since' | translate }}
                    </small>
                  </div>
                </div>
                <div class="col-auto">
                  <div class="icon icon-shape bg-gradient-danger text-white rounded-circle shadow">
                    <i class="ni ni-archive-2"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Reports Card -->
        <div class="col">
          <div class="card card-stats mb-4 mb-xl-0">
            <div class="card-body">
              <div class="row">
                <div class="col">
                  <h5 class="card-title text-uppercase text-muted mb-0">{{ 'dashboard.stats.reports' | translate }}</h5>
                  <span class="h2 font-weight-bold mb-0">{{ reportsCount }}</span>
                  <div class="mt-2">
                    <small 
                      [ngClass]="{
                        'text-success': reportsPercentageChange >= 0,
                        'text-danger': reportsPercentageChange < 0
                      }">
                      <i class="fa" 
                         [ngClass]="{
                           'fa-arrow-up': reportsPercentageChange >= 0,
                           'fa-arrow-down': reportsPercentageChange < 0
                         }"></i>
                      <span class="percentage-number">
                        {{ reportsPercentageChange | number: '1.0-0' }}%
                      </span>
                      {{ 'dashboard.stats.since' | translate }}
                    </small>
                  </div>
                </div>
                <div class="col-auto">
                  <div class="icon icon-shape bg-gradient-warning text-white rounded-circle shadow">
                    <i class="ni ni-chart-bar-32"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- DMN Card -->
        <div class="col">
          <div class="card card-stats mb-4 mb-xl-0">
            <div class="card-body">
              <div class="row">
                <div class="col">
                  <h5 class="card-title text-uppercase text-muted mb-0">{{ 'dashboard.stats.dmn' | translate }}</h5>
                  <span class="h2 font-weight-bold mb-0">{{ dmnCount | number: '1.0-0' }}</span>
                  <div class="mt-2">
                    <small 
                      [ngClass]="{
                        'text-success': dmnPercentageChange >= 0,
                        'text-danger': dmnPercentageChange < 0
                      }">
                      <i class="fa" 
                        [ngClass]="{
                          'fa-arrow-up': dmnPercentageChange >= 0,
                          'fa-arrow-down': dmnPercentageChange < 0
                        }"></i>
                      <span class="percentage-number">
                        {{ dmnPercentageChange | number: '1.0-0' }}%
                      </span>
                      {{ 'dashboard.stats.since' | translate }}
                    </small>
                  </div>
                </div>
                <div class="col-auto">
                  <div class="icon icon-shape bg-gradient-info text-white rounded-circle shadow">
                    <i class="ni ni-cloud-download-95"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Users Card -->
        <div class="col">
          <div class="card card-stats mb-4 mb-xl-0">
            <div class="card-body">
              <div class="row">
                <div class="col">
                  <h5 class="card-title text-uppercase text-muted mb-0">{{ 'dashboard.stats.users' | translate }}</h5>
                  <span class="h2 font-weight-bold mb-0">{{ usersCount | number: '1.0-0' }}</span>
                  <div class="mt-2">
                    <small 
                      [ngClass]="{
                        'text-success': usersPercentageChange >= 0,
                        'text-danger': usersPercentageChange < 0
                      }">
                      <i class="fa" 
                        [ngClass]="{
                          'fa-arrow-up': usersPercentageChange >= 0,
                          'fa-arrow-down': usersPercentageChange < 0
                        }"></i>
                      <span class="percentage-number">
                        {{ usersPercentageChange | number: '1.0-0' }}%
                      </span>
                      {{ 'dashboard.stats.since' | translate }}
                    </small>
                  </div>
                </div>
                <div class="col-auto">
                  <div class="icon icon-shape bg-gradient-primary text-white rounded-circle shadow">
                    <i class="ni ni-circle-08"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Graphique linéaire des indicateurs financiers -->
<div class="container-fluid mt--7">
  <div class="row">
    <!-- Carte principale : Évolution des rapports générés -->
    <div class="col-xl-8 mb-5 mb-xl-0">
      <div class="card bg-gradient-default shadow">
        <div class="card-header bg-transparent">
          <div class="row align-items-center">
            <div class="col">
              <h6 class="text-uppercase text-light ls-1 mb-1">{{ 'dashboard.charts.reportsGenerated.overview' | translate }}</h6>
              <h2 class="text-white mb-0">{{ 'dashboard.charts.reportsGenerated.title' | translate }}</h2>
            </div>
            <div class="col">
              <ul class="nav nav-pills justify-content-end">
                <li class="nav-item mr-2 mr-md-0" (click)="selectTimeRange('month')">
                  <a href="javascript:void(0)" class="nav-link py-2 px-3"
                    [ngClass]="{'active': selectedRange === 'month'}">
                    <span class="d-none d-md-block">{{ 'dashboard.charts.reportsGenerated.timeRange.month' | translate }}</span>
                    <span class="d-md-none">M</span>
                  </a>
                </li>
                <li class="nav-item" (click)="selectTimeRange('week')">
                  <a href="javascript:void(0)" class="nav-link py-2 px-3"
                    [ngClass]="{'active': selectedRange === 'week'}">
                    <span class="d-none d-md-block">{{ 'dashboard.charts.reportsGenerated.timeRange.week' | translate }}</span>
                    <span class="d-md-none">W</span>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="card-body">
          <!-- Graphique linéaire des rapports générés -->
          <div class="chart" style="position: relative; height: 350px; width: 100%;">
            <canvas baseChart [datasets]="lineChartData.datasets" [labels]="lineChartLabels"
              [options]="lineChartOptions" [legend]="lineChartLegend" [type]="lineChartType">
            </canvas>
          </div>

        </div>
      </div>
    </div>

    <!-- Carte Templates Créés -->
    <div class="col-xl-4">
      <div class="card shadow">
        <div class="card-header bg-transparent">
          <div class="row align-items-center">
            <div class="col">
              <h6 class="text-uppercase text-muted ls-1 mb-1">{{ 'dashboard.charts.templatesCreated.performance' | translate }}</h6>
              <h2 class="mb-0">{{ 'dashboard.charts.templatesCreated.title' | translate }}</h2>
            </div>
          </div>
        </div>
        <div class="card-body">
          <!-- Graphique Templates Créés -->
          <div class="chart" style="height: 100%;height: 350px;">
            <canvas baseChart [datasets]="horizontalBarChartData.datasets" [labels]="horizontalBarChartLabels"
              [options]="horizontalBarChartOptions" [legend]="horizontalBarChartLegend" [type]="horizontalBarChartType"
              [ngStyle]="{'height': '300px'}">
            </canvas>

          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Activity Logs Table Card -->
  <div class="row mt-4">
    <div class="col">
      <div class="card shadow">
        <div class="card-header bg-transparent d-flex justify-content-between align-items-center">
          <h3 class="mb-0">{{ 'dashboard.activityLogs.title' | translate }}</h3>
          <!-- Action Type Filter Dropdown -->
          <div class="form-group mb-0" style="min-width: 220px;">
            <label class="form-control-label text-muted small mb-2">
              {{ 'dashboard.activityLogs.filters.actionType' | translate }}
            </label>
            <select class="form-control form-control-sm" [(ngModel)]="selectedActionType" (change)="applyActionTypeFilter()">
              <option value="ALL">{{ 'dashboard.activityLogs.filters.all' | translate }}</option>
              <option *ngFor="let type of actionTypes" [value]="type.value">{{ type.label | translate }}</option>
            </select>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table align-items-center table-flush table-hover">
            <thead class="thead-light">
              <tr>
                <th scope="col" class="text-uppercase text-muted text-xs font-weight-bolder">
                  {{ 'dashboard.activityLogs.headers.user' | translate }}
                </th>
                <th scope="col" class="text-uppercase text-muted text-xs font-weight-bolder">
                  {{ 'dashboard.activityLogs.headers.actionType' | translate }}
                </th>
                <th scope="col" class="text-uppercase text-muted text-xs font-weight-bolder">
                  {{ 'dashboard.activityLogs.headers.description' | translate }}
                </th>
                <th scope="col" class="text-uppercase text-muted text-xs font-weight-bolder">
                  {{ 'dashboard.activityLogs.headers.timestamp' | translate }}
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let log of paginatedLogs; let i = index">
                <td class="text-sm font-weight-normal">{{ log.user.username }}</td>
                <td>
                  <span
                    class="badge"
                    [ngClass]="{
                      'badge-primary': log.actionType === 'CREATE_TEMPLATE',
                      'badge-warning': log.actionType === 'SUBMIT_REPORT',
                      'badge-danger': log.actionType === 'DELETE_TEMPLATE' || log.actionType === 'DELETE_VALIDATION_MODEL',
                      'badge-success': log.actionType === 'VALIDATE_REPORT',
                      'badge-info': log.actionType === 'CREATE_VALIDATION_MODEL',
                      'badge-dark': log.actionType === 'REJECT_REPORT'
                    }"
                    style="
                      font-size: 0.95em;
                      padding: 0.4em 0.8em;
                      font-weight: bold;
                      min-width: 110px;
                      display: inline-block;
                      text-align: center;
                      border-radius: 0.5em;
                      text-transform: capitalize;
                      float: left;
                      clear: both;
                    "
                  >
                    {{ ('dashboard.activityLogs.actionTypes.' + log.actionType) | translate }}
                  </span>
                </td>
                <!-- Dynamic translated message -->
                <td class="text-sm font-weight-normal">
                  {{ log.messageKey ? (log.messageKey | translate: log.params) : log.description }}
                </td>

                <td class="text-sm font-weight-normal">
                  {{ log.timestamp | date:'medium' }}
                </td>
              </tr>
            </tbody>
          </table>

          <div *ngIf="!activityLogs.length && !loadingLogs" class="text-center p-4 text-muted font-italic">
            {{ 'dashboard.activityLogs.noLogsFound' | translate }}
          </div>
        </div>

        <!-- Pagination Controls -->
        <div *ngIf="activityLogs.length > itemsPerPage" class="card-footer py-4">
          <nav aria-label="...">
            <ul class="pagination justify-content-end mb-0">
              <li class="page-item" [class.disabled]="currentPage === 1">
                <a class="page-link" href="javascript:void(0)" (click)="prevPage()">
                  <i class="fas fa-angle-left"></i>
                  <span class="sr-only">{{ 'dashboard.pagination.previous' | translate }}</span>
                </a>
              </li>
              <li
                class="page-item"
                *ngFor="let page of getPages()"
                [class.active]="page === currentPage"
              >
                <a class="page-link" href="javascript:void(0)" (click)="goToPage(page)">{{ page }}</a>
              </li>
              <li class="page-item" [class.disabled]="currentPage === totalPages">
                <a class="page-link" href="javascript:void(0)" (click)="nextPage()">
                  <i class="fas fa-angle-right"></i>
                  <span class="sr-only">{{ 'dashboard.pagination.next' | translate }}</span>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>


</div>



<!-- Contenu principal du Dashboard -->
<div class="container-fluid mt--7 dashboard-container">

  <!-- Carte Template Builder -->
  <div class="card bg-gradient-danger text-white mb-3"
    style="margin-top: 150px; border-radius: 15px; font-family: 'Roboto', sans-serif;">
    <div class="card-body d-flex align-items-center">
      <div class="flex-grow-1 text-start">
        <h4 class="card-title text-white" style="font-size: 1.5rem;">{{ 'dashboard.quickAccess.templateBuilder.title' | translate }}</h4>
        <p class="card-text">
          {{ 'dashboard.quickAccess.templateBuilder.description' | translate }}
        </p>
        <button class="btn btn-link text-white border-white" (click)="goToTemplateBuilder()">{{ 'dashboard.quickAccess.templateBuilder.action' | translate }}</button>
      </div>
    </div>
  </div>


  <!-- Carte Template List -->
  <div class="card bg-gradient-danger text-white mb-3"
    style="margin-top: 10px; border-radius: 15px; font-family: 'Roboto', sans-serif;">
    <div class="card-body d-flex align-items-center">
      <div class="flex-grow-1 text-start">
        <h4 class="card-title text-white" style="font-size: 1.5rem;">{{ 'dashboard.quickAccess.templateList.title' | translate }}</h4>
        <p class="card-text">
          {{ 'dashboard.quickAccess.templateList.description' | translate }}
        </p>
        <button class="btn btn-link text-white border-white" (click)="goToTemplates()">{{ 'dashboard.quickAccess.templateList.action' | translate }}</button>
      </div>
    </div>
  </div>

  <!-- Carte Liste des Bilans -->
<div class="card bg-gradient-danger text-white mb-3"
style="margin-top: 10px; border-radius: 15px; font-family: 'Roboto', sans-serif;">
<div class="card-body d-flex align-items-center">
  <div class="flex-grow-1 text-start">
    <h4 class="card-title text-white" style="font-size: 1.5rem;">{{ 'dashboard.quickAccess.reportList.title' | translate }}</h4>
    <p class="card-text">
      {{ 'dashboard.quickAccess.reportList.description' | translate }}
    </p>
    <button class="btn btn-link text-white border-white" (click)="goToFinancialStatementsList()">{{ 'dashboard.quickAccess.reportList.action' | translate }}</button>
  </div>
</div>
</div>

  
  
  <!-- Timeline Section -->
<div class="card-body p-0">
  <div class="d-flex flex-column flex-lg-row">
    <!-- Left section with timeline -->
    <div style="flex: 1.3; padding: 40px 30px 30px 30px;">
      <div class="position-relative" style="padding-left: 40px;">
        <!-- Timeline vertical line -->
        <div style="position: absolute; left: 29px; top: 0; bottom: 0; width: 2px;"></div>
        
        <!-- Step 1 -->
        <div class="mb-5 position-relative">
          <div class="position-absolute" style="left: -50px; top: 0;">
            <div class="rounded-circle shadow-lg d-flex align-items-center justify-content-center" 
                style="width: 80px; height: 80px; z-index: 1; background: white; border: 3px solid #f5365c; box-shadow: 0 0 0 5px rgba(245, 54, 92, 0.2), 0 10px 20px rgba(0,0,0,0.1);">
              <span style="font-size: 1.8rem; font-weight: 800; background: linear-gradient(87deg, #f5365c 0, #f56036 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">1</span>
            </div>
          </div>
          <div style="margin-left: 30px;">
            <div class="card-body p-4" style="background: linear-gradient(135deg, #f8f9fe 0%, #ffffff 100%);transform: translateY(-15px);">
              <h4 style="font-size: 1.4rem; font-weight: 700; margin-bottom: 10px; color: #32325d;">{{ 'dashboard.timeline.step1.title' | translate }}</h4>
              <p style="font-size: 1.05rem; color: #525f7f; line-height: 1.6; margin-bottom: 0;">
                {{ 'dashboard.timeline.step1.description' | translate }}
              </p>
            </div>
          </div>
        </div>
        
        <!-- Step 2 -->
        <div class="mb-5 position-relative">
          <div class="position-absolute" style="left: -50px; top: 0;">
            <div class="rounded-circle shadow-lg d-flex align-items-center justify-content-center" 
                style="width: 80px; height: 80px; z-index: 1; background: white; border: 3px solid #f5365c; box-shadow: 0 0 0 5px rgba(245, 54, 92, 0.2), 0 10px 20px rgba(0,0,0,0.1);">
              <span style="font-size: 1.8rem; font-weight: 800; background: linear-gradient(87deg, #f5365c 0, #f56036 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">2</span>
            </div>
          </div>
          <div style="margin-left: 30px;">
            <div class="card-body p-4" style="background: linear-gradient(135deg, #f8f9fe 0%, #ffffff 100%);transform: translateY(-15px);">
              <h4 style="font-size: 1.4rem; font-weight: 700; margin-bottom: 10px; color: #32325d;">{{ 'dashboard.timeline.step2.title' | translate }}</h4>
              <p style="font-size: 1.05rem; color: #525f7f; line-height: 1.6; margin-bottom: 0;">
                {{ 'dashboard.timeline.step2.description' | translate }}
              </p>
            </div>
          </div>
        </div>
        
        <!-- Step 3 -->
        <div class="position-relative">
          <div class="position-absolute" style="left: -50px; top: 0;">
            <div class="rounded-circle shadow-lg d-flex align-items-center justify-content-center" 
                style="width: 80px; height: 80px; z-index: 1; background: white; border: 3px solid #f5365c; box-shadow: 0 0 0 5px rgba(245, 54, 92, 0.2), 0 10px 20px rgba(0,0,0,0.1);">
              <span style="font-size: 1.8rem; font-weight: 800; background: linear-gradient(87deg, #f5365c 0, #f56036 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">3</span>
            </div>
          </div>
          <div style="margin-left: 30px;">
            <div class="card-body p-4" style="background: linear-gradient(135deg, #f8f9fe 0%, #ffffff 100%);transform: translateY(-15px);">
              <h4 style="font-size: 1.4rem; font-weight: 700; margin-bottom: 10px; color: #32325d;">{{ 'dashboard.timeline.step3.title' | translate }}</h4>
              <p style="font-size: 1.05rem; color: #525f7f; line-height: 1.6; margin-bottom: 0;">
                {{ 'dashboard.timeline.step3.description' | translate }}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Right section with visualization -->
    <div style="flex: 0.9; background: linear-gradient(135deg, rgba(245, 54, 92, 0.05) 0%, rgba(245, 96, 54, 0.1) 100%); padding: 30px; display: flex; flex-direction: column; justify-content: center; align-items: center;" class="rounded-end">
      <div class="position-relative" style="width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;">
        <div style="position: absolute; width: 300px; height: 300px; border-radius: 50%; background: radial-gradient(circle, rgba(245, 54, 92, 0.1), transparent 70%);"></div>
        <img src="assets/img/brand/logo2.jpg" alt="Financial Statement" 
             class="img-fluid" style="max-height: 340px; object-fit: contain; border-radius: 16px; box-shadow: 0 20px 40px rgba(0,0,0,0.15); transform: perspective(1000px) rotateY(-10deg); transition: transform 0.5s ease;">
      </div>
    </div>
  </div>
</div>

<!-- Footer avec action --> 
<div style="background-color: #f8f9fe; padding: 20px 30px; border-top: 1px solid rgba(0,0,0,0.05);" class="d-flex justify-content-end">
  <button 
    class="btn text-white d-flex align-items-center gap-2" 
    style="background: linear-gradient(87deg, #f5365c 0, #f56036 100%); border-radius: 50px; padding: 10px 25px; font-weight: 600; box-shadow: 0 5px 15px rgba(245, 54, 92, 0.3); transition: all 0.3s ease;" 
    (click)="goToTemplateBuilder()"
  >
    <i class="fas fa-arrow-right"></i>
    &nbsp;{{ 'dashboard.actions.startNow' | translate }}
  </button>
</div>
</div>
